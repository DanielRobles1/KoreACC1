<div *ngIf="open" class="backdrop" (click)="close()">
  <div
    class="modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="tp-title"
    (click)="$event.stopPropagation()"
    [attr.aria-busy]="loading ? 'true' : 'false'">

    <header class="modal-header">
      <h3 id="tp-title">Tipos de póliza</h3>
      <button type="button" class="icon-btn" (click)="close()">✕</button>
    </header>

    <!-- LISTA -->
    <div class="modal-body" style="padding-bottom: 0;">
      <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
        <strong>Tipos registrados</strong>
        <button class="btn ghost" type="button" (click)="loadTipos()" [disabled]="loading">
          {{ loading ? 'Actualizando…' : 'Actualizar' }}
        </button>
      </div>

      <div style="max-height: 220px; overflow:auto; border:1px solid #eee; border-radius:10px;">
        <table style="width:100%; border-collapse:collapse; font-size:14px;">
          <thead>
            <tr style="background:#fafafa;">
              <th style="padding:10px;">#</th>
              <th style="padding:10px;">Naturaleza</th>
              <th style="padding:10px;">Descripción</th>
              <th style="padding:10px; width:1%;">Acciones</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngIf="!tipos.length">
              <td colspan="4" style="padding:12px; text-align:center;">No hay tipos registrados</td>
            </tr>

            <tr *ngFor="let t of tipos; let i = index">
              <td style="padding:10px;">{{ i + 1 }}</td>
              <td style="padding:10px;">{{ t.naturaleza | titlecase }}</td>
              <td style="padding:10px;">{{ t.descripcion }}</td>

              <td style="padding:10px;">
                <div style="display:flex; gap:8px;">
                  <!-- EDITAR -->
                  <button class="icon-btn" (click)="startEdit(t)" title="Editar">
                    <svg width="18" height="18" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2">
                      <path d="M12 20h9"></path>
                      <path d="M16.5 3.5a2 2 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
                    </svg>
                  </button>

                  <!-- ELIMINAR -->
                  <button class="icon-btn" (click)="confirmarEliminar(t)" title="Eliminar">
                    <svg width="18" height="18" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6l-1 14H6L5 6"></path>
                      <path d="M10 11v6"></path>
                      <path d="M14 11v6"></path>
                      <path d="M9 6V4h6v2"></path>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>

        </table>
      </div>
    </div>

    <!-- FORM -->
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="modal-body">

      <div *ngIf="editing" class="pill">Editando: {{ tipoEditando?.descripcion }}</div>

      <div class="form-row">
        <label>Naturaleza *</label>
        <select formControlName="naturaleza">
          <option value="" disabled>— Selecciona —</option>
          <option *ngFor="let n of naturalezas" [value]="n">{{ n | titlecase }}</option>
        </select>
      </div>

      <div class="form-row">
        <label>Descripción *</label>
        <input formControlName="descripcion" placeholder="p. ej. Póliza de ventas" />
      </div>

      <footer class="modal-footer">
        <button type="button" class="btn ghost" (click)="editing ? cancelEdit() : close()">
          {{ editing ? 'Cancelar edición' : 'Cancelar' }}
        </button>

        <button type="submit" class="btn primary" [disabled]="form.invalid || loading">
          {{ editing ? (loading ? 'Actualizando…' : 'Actualizar') : (loading ? 'Guardando…' : 'Guardar') }}
        </button>
      </footer>
    </form>
  </div>
</div>

<!-- MODAL CONFIRMACIÓN ELIMINAR -->
<app-modal
  *ngIf="showDeleteModal"
  [open]="showDeleteModal"
  title="Confirmar eliminación"
  size="sm"
  (confirmed)="eliminarDefinitivo()"
  (closed)="cancelarEliminar()"
  (canceled)="cancelarEliminar()">

  <p>¿Eliminar el tipo de póliza <strong>{{ tipoAEliminar?.descripcion }}</strong>?</p>
</app-modal>
